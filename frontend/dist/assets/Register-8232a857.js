import{u as E,r as c,a as b,b as d,o as U,c as h,d as n,e as o,w as l,f as m,E as i}from"./index-e807a5c3.js";import{a as f}from"./auth-141c36a1.js";import{_ as P}from"./_plugin-vue_export-helper-608cf584.js";const R={class:"auth-container"},q={class:"auth-card"},A={class:"auth-links"},C={__name:"Register",setup(z){const _=E(),p=c(!1),g=c(),s=b({username:"",nickname:"",email:"",password:"",confirmPassword:"",agreement:!1}),w={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:(u,e,r)=>{if(!e){r(new Error("请输入用户名"));return}if(!/^[a-zA-Z0-9_]{3,20}$/.test(e)){r(new Error("用户名只能包含字母、数字、下划线，长度3-20位"));return}f.checkUsername(e).then(a=>{a.data.code===200&&a.data.data===!0?r(new Error("该用户名已被使用")):r()}).catch(()=>{r()})},trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:10,message:"昵称长度在 2 到 10 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(u,e,r)=>{if(!e){r(new Error("请输入邮箱"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){r(new Error("请输入正确的邮箱格式"));return}f.checkEmail(e).then(a=>{a.data.code===200&&a.data.data===!0?r(new Error("该邮箱已被使用")):r()}).catch(()=>{r()})},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,20}$/,message:"密码必须包含大小写字母和数字，长度8-20位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(u,e,r)=>{e!==s.password?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}],agreement:[{type:"boolean",required:!0,message:"请同意用户协议",trigger:"change"}]},v=async()=>{g.value&&await g.value.validate(async u=>{if(u){p.value=!0;try{const e={username:s.username,password:s.password,nickname:s.nickname,email:s.email,gender:2,school:"工业大学"};console.log("注册数据:",e);const r=await f.register(e);r.data.code===200?(i.success("注册成功，请登录"),_.push("/login")):i.error(r.data.message||"注册失败")}catch(e){if(console.error("注册错误:",e),e.response&&e.response.data&&e.response.data.message){const r=e.response.data.message;r.includes("Duplicate entry")&&r.includes("uk_phone")?i.error("手机号已被使用，请使用其他手机号"):r.includes("Duplicate entry")&&r.includes("uk_email")?i.error("邮箱已被使用，请使用其他邮箱"):r.includes("Duplicate entry")&&r.includes("uk_username")?i.error("用户名已被使用，请使用其他用户名"):i.error(r)}else i.error("注册失败，请检查网络连接")}finally{p.value=!1}}})};return(u,e)=>{const r=d("el-input"),a=d("el-form-item"),V=d("el-checkbox"),k=d("el-button"),y=d("el-form"),x=d("router-link");return U(),h("div",R,[n("div",q,[e[10]||(e[10]=n("div",{class:"logo-section"},[n("h1",{class:"logo"},"加入工大人社交圈"),n("p",{class:"subtitle"},"开启你的校园社交之旅")],-1)),o(y,{ref_key:"registerFormRef",ref:g,model:s,rules:w,class:"register-form",size:"large"},{default:l(()=>[o(a,{prop:"username"},{default:l(()=>[o(r,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=t=>s.username=t),placeholder:"请输入用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(a,{prop:"nickname"},{default:l(()=>[o(r,{modelValue:s.nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>s.nickname=t),placeholder:"请输入昵称","prefix-icon":"Avatar"},null,8,["modelValue"])]),_:1}),o(a,{prop:"email"},{default:l(()=>[o(r,{modelValue:s.email,"onUpdate:modelValue":e[2]||(e[2]=t=>s.email=t),placeholder:"请输入邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),o(a,{prop:"password"},{default:l(()=>[o(r,{modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=t=>s.password=t),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(a,{prop:"confirmPassword"},{default:l(()=>[o(r,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>s.confirmPassword=t),type:"password",placeholder:"请确认密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(a,{prop:"agreement"},{default:l(()=>[o(V,{modelValue:s.agreement,"onUpdate:modelValue":e[5]||(e[5]=t=>s.agreement=t)},{default:l(()=>e[6]||(e[6]=[m(" 我已阅读并同意 "),n("span",{class:"agreement-link"},"《用户协议》",-1),m(" 和 "),n("span",{class:"agreement-link"},"《隐私政策》",-1)])),_:1,__:[6]},8,["modelValue"])]),_:1}),o(a,null,{default:l(()=>[o(k,{type:"primary",class:"register-btn",loading:p.value,onClick:v},{default:l(()=>e[7]||(e[7]=[m(" 注册 ")])),_:1,__:[7]},8,["loading"])]),_:1})]),_:1},8,["model"]),n("div",A,[e[9]||(e[9]=n("span",null,"已有账号？",-1)),o(x,{to:"/login",class:"link"},{default:l(()=>e[8]||(e[8]=[m("立即登录")])),_:1,__:[8]})])])])}}},Z=P(C,[["__scopeId","data-v-99b22113"]]);export{Z as default};
