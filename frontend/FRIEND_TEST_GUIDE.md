# 好友功能测试指南

## 🎯 测试目标

验证前端好友页面与后端好友请求接口的集成是否正常工作。

## 📋 测试前准备

### 1. 环境要求
- 后端服务运行在 `http://localhost:8080`
- 前端服务运行在 `http://localhost:3000`
- 数据库中有多个测试用户账号

### 2. 启动服务
```bash
# 启动后端服务（在项目根目录）
mvn spring-boot:run

# 启动前端服务（在frontend目录）
cd frontend
npm run dev
```

### 3. 准备测试数据
确保数据库中有以下测试用户：
- 用户1: username=test1, password=123456, id=1
- 用户2: username=test2, password=123456, id=2
- 用户3: username=test3, password=123456, id=3

## 🧪 测试步骤

### 步骤1: 用户登录
1. 访问 http://localhost:3000/login
2. 使用test1账号登录 (username: test1, password: 123456)
3. 点击"登录"按钮
4. **期望结果**: 登录成功，跳转到首页

### 步骤2: 访问好友页面
1. 在导航栏点击"好友"或直接访问 http://localhost:3000/friends
2. **期望结果**: 成功加载好友页面，显示搜索栏和添加好友表单

### 步骤3: 测试表单验证
1. 在"直接添加好友"输入框中不输入任何内容
2. 点击"发送请求"按钮
3. **期望结果**: 显示"请输入用户ID"错误提示

### 步骤4: 测试无效用户ID格式
1. 在用户ID输入框输入非数字内容如"abc"
2. 点击"发送请求"按钮
3. **期望结果**: 显示"用户ID必须是数字"错误提示

### 步骤5: 测试有效好友请求
1. 在用户ID输入框输入"2"（对应test2用户）
2. 点击"发送请求"按钮
3. **期望结果**: 
   - 按钮显示loading状态
   - 收到"请求已发送"成功提示
   - 输入框自动清空

### 步骤6: 测试重复请求
1. 再次在用户ID输入框输入"2"
2. 点击"发送请求"按钮
3. **期望结果**: 显示相应的错误提示（如"已发送过请求"）

### 步骤7: 测试不存在的用户ID
1. 在用户ID输入框输入一个不存在的用户ID如"999"
2. 点击"发送请求"按钮
3. **期望结果**: 显示"用户不存在"或类似错误提示

### 步骤8: 测试向自己发送请求
1. 在用户ID输入框输入"1"（当前登录用户的ID）
2. 点击"发送请求"按钮
3. **期望结果**: 显示"不能向自己发送好友请求"错误提示

### 步骤9: 验证后端数据
1. 切换到test2账号登录
2. 访问好友页面
3. 点击"好友申请"标签
4. **期望结果**: 能看到来自test1的好友申请

## 🔍 测试检查点

### 前端检查
- [ ] 表单验证是否正常工作
- [ ] 用户ID格式验证是否生效
- [ ] 发送按钮loading状态是否显示
- [ ] 成功/错误消息是否正确显示
- [ ] 输入框清空功能是否正常

### 网络请求检查
打开浏览器开发者工具 -> Network标签页：
- [ ] 请求URL: `http://localhost:8080/api/friend/apply`
- [ ] 请求方法: `POST`
- [ ] 请求头包含: `Authorization: Bearer [token]`
- [ ] 请求体格式正确：
  ```json
  {
    "friendId": 2,
    "reason": "希望成为好友",
    "remark": "同学"
  }
  ```

### 后端检查
- [ ] 后端接收到正确的请求参数
- [ ] 返回正确的响应格式
- [ ] 数据库中新增好友请求记录
- [ ] 处理各种异常情况（重复请求、用户不存在等）

## 📊 测试数据示例

### 测试用例1: 正常发送请求
```json
{
  "friendId": 2,
  "reason": "希望成为好友",
  "remark": "同学"
}
```

### 测试用例2: 大用户ID
```json
{
  "friendId": 999999,
  "reason": "希望成为好友"
}
```

### 测试用例3: 边界情况
```json
{
  "friendId": 0,
  "reason": "测试"
}
```

## 📋 API响应示例

### 成功响应
```json
{
  "code": 200,
  "message": "好友请求发送成功",
  "data": {
    "id": 123,
    "userId": 1,
    "targetUserId": 2,
    "status": 0,
    "createTime": "2024-01-01 12:00:00"
  }
}
```

### 失败响应 - 用户不存在
```json
{
  "code": 404,
  "message": "目标用户不存在",
  "data": null
}
```

### 失败响应 - 重复请求
```json
{
  "code": 400,
  "message": "已发送过好友请求",
  "data": null
}
```

### 失败响应 - 向自己发送请求
```json
{
  "code": 400,
  "message": "不能向自己发送好友请求",
  "data": null
}
```

## ✅ 测试通过标准

- 所有基础功能测试用例通过
- 网络请求格式正确
- 表单验证机制正常
- 错误处理机制正常
- 用户体验流畅
- 无控制台错误

## 🔄 扩展测试

### 功能扩展测试
1. 测试其他好友相关功能（如果已实现）
2. 测试好友申请列表
3. 测试好友列表展示
4. 测试用户搜索功能

### 性能测试
1. 快速连续点击发送按钮
2. 输入大量数字测试
3. 网络慢速情况下的表现

### 兼容性测试
1. 不同浏览器测试
2. 移动端响应式测试
3. 不同屏幕尺寸测试

## 🐛 常见问题排查

### 问题1: 登录后访问好友页面显示401错误
**原因**: Token未正确传递或已过期
**解决**: 
1. 检查localStorage中是否有token
2. 检查请求头是否包含Authorization字段
3. 重新登录获取新token

### 问题2: 发送请求时显示网络错误
**原因**: 后端服务未启动或端口不匹配
**解决**:
1. 确认后端服务在8080端口运行
2. 检查Vite代理配置是否正确
3. 确认好友相关接口已实现

### 问题3: 发送成功但数据库无记录
**原因**: 后端逻辑问题或事务回滚
**解决**: 
1. 检查后端日志
2. 确认数据库连接正常
3. 检查数据库表结构

### 问题4: 验证失败但仍能发送请求
**原因**: 表单验证配置问题
**解决**: 
1. 检查el-form-item的prop属性
2. 确认验证规则配置正确
3. 检查表单ref是否正确绑定

---

**测试版本**: v1.0.0  
**最后更新**: 2024年1月  
**相关接口**: POST /api/friend/apply 