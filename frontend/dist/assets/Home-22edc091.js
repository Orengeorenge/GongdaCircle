import{u as ce,r as m,g as ie,b as l,o as c,c as u,e as t,w as a,E as f,d as o,f as i,t as r,F as x,h as P,i as D,j as S}from"./index-e807a5c3.js";import{A as re}from"./AppHeader-c9079225.js";import{p as z}from"./post-2ee5c828.js";import{_ as de,g as ue}from"./_plugin-vue_export-helper-608cf584.js";const _e={class:"home-container"},me={class:"container"},ve={class:"card quick-post"},fe={class:"quick-post-header"},pe={class:"quick-post-actions"},ge={class:"posts-container"},ke={class:"post-header"},he={class:"user-info"},ye={class:"user-details"},we={class:"username"},Ce={class:"post-time"},xe={class:"post-content"},Pe={key:0,class:"post-title"},Le={class:"post-text"},Ie={key:1,class:"post-images"},Me={key:2,class:"post-tags"},be={class:"post-actions"},ze={class:"action-stats"},Ae={class:"stat-item"},De={class:"stat-item"},Se={class:"stat-item"},Ve={class:"action-buttons"},$e={class:"load-more"},Ee={key:1,class:"no-more"},Te={class:"sidebar"},qe={class:"card"},Be={class:"hot-topics"},He={class:"topic-name"},Ne={class:"topic-count"},Re={class:"card"},Fe={class:"recommend-users"},Ue={class:"user-info"},je={class:"nickname"},Ge={class:"desc"},Je={__name:"Home",setup(Ke){const H=ce(),A=m({nickname:"工大学子",avatar:""}),L=m([]),V=m(!1),I=m(!1);m(!1);const M=m(!0),h=m(null),k=m(1),$=m(10),b=m(1),N=m([{name:"工大校园",count:128},{name:"学习心得",count:86},{name:"社团活动",count:64},{name:"美食推荐",count:42},{name:"求职经验",count:38}]),R=m([{id:1,nickname:"学霸小明",desc:"计算机学院 · 大三",avatar:""},{id:2,nickname:"文艺小芳",desc:"文学院 · 大二",avatar:""},{id:3,nickname:"运动达人",desc:"体育学院 · 大四",avatar:""}]),F=async()=>{try{V.value=!0,h.value=null;const n={page:k.value,size:$.value};console.log("发起请求获取帖子列表:",n);const e=await z.getPostList(n);if(console.log("获取帖子列表响应:",e),e.code===200){const g=(e.data.records||[]).map(d=>(d.userInfo||(d.userInfo={nickname:"未知用户",avatar:""}),d));L.value=g,b.value=e.data.pages||1,M.value=k.value<b.value}else h.value=e.message||"加载帖子失败",f.error(h.value)}catch(n){console.error("加载帖子出错:",n),h.value="网络错误，请稍后重试",f.error(h.value)}finally{V.value=!1}},U=async()=>{if(!(I.value||!M.value))try{I.value=!0,k.value++;const n={page:k.value,size:$.value};console.log("发起请求加载更多帖子:",n);const e=await z.getPostList(n);if(console.log("加载更多帖子响应:",e),e.code===200){const g=(e.data.records||[]).map(d=>(d.userInfo||(d.userInfo={nickname:"未知用户",avatar:""}),d));L.value=[...L.value,...g],b.value=e.data.pages||1,M.value=k.value<b.value}else f.error(e.message||"加载更多帖子失败"),k.value--}catch(n){console.error("加载更多帖子出错:",n),f.error("网络错误，请稍后重试"),k.value--}finally{I.value=!1}},j=n=>{if(!n)return"";const e=new Date(n),d=new Date-e,y=Math.floor(d/(1e3*60)),v=Math.floor(d/(1e3*60*60)),_=Math.floor(d/(1e3*60*60*24));return y<1?"刚刚":y<60?`${y}分钟前`:v<24?`${v}小时前`:_<7?`${_}天前`:e.toLocaleDateString()},G=async n=>{try{console.log("发起点赞请求:",n.id);const e=await z.likePost(n.id);console.log("点赞响应:",e),e.code===200?(n.isLiked=!n.isLiked,n.likeCount=n.isLiked?n.likeCount+1:n.likeCount-1,f.success(n.isLiked?"点赞成功":"已取消点赞")):f.error(e.message||"操作失败")}catch(e){console.error("点赞操作失败:",e),f.error("网络错误，请稍后重试")}},J=n=>{f.info("评论功能开发中...")},K=async n=>{try{console.log("发起收藏请求:",n.id);const e=await z.collectPost(n.id);console.log("收藏响应:",e),e.code===200?f.success("收藏成功"):f.error(e.message||"收藏失败")}catch(e){console.error("收藏操作失败:",e),f.error("网络错误，请稍后重试")}},E=()=>{H.push("/publish")};return ie(()=>{const n=ue();n&&(A.value=n),F()}),(n,e)=>{const g=l("el-avatar"),d=l("el-input"),y=l("EditPen"),v=l("el-icon"),_=l("el-button"),O=l("Picture"),Q=l("VideoCamera"),W=l("More"),T=l("el-dropdown-item"),X=l("el-dropdown-menu"),Y=l("el-dropdown"),Z=l("el-image"),ee=l("el-tag"),te=l("Like"),se=l("ChatDotRound"),oe=l("Star"),ne=l("Share"),q=l("el-col"),ae=l("el-row"),le=l("el-main");return c(),u("div",_e,[t(re),t(le,{class:"main-content"},{default:a(()=>[o("div",me,[t(ae,{gutter:20},{default:a(()=>[t(q,{lg:16,md:24,sm:24,xs:24},{default:a(()=>[o("div",ve,[o("div",fe,[t(g,{size:40,src:A.value.avatar},{default:a(()=>{var s;return[i(r((s=A.value.nickname)==null?void 0:s.charAt(0)),1)]}),_:1},8,["src"]),t(d,{placeholder:"分享你的想法...",readonly:"",class:"quick-input",onClick:E})]),o("div",pe,[t(_,{text:"",onClick:E},{default:a(()=>[t(v,null,{default:a(()=>[t(y)]),_:1}),e[0]||(e[0]=i(" 发布动态 "))]),_:1,__:[0]}),t(_,{text:""},{default:a(()=>[t(v,null,{default:a(()=>[t(O)]),_:1}),e[1]||(e[1]=i(" 图片 "))]),_:1,__:[1]}),t(_,{text:""},{default:a(()=>[t(v,null,{default:a(()=>[t(Q)]),_:1}),e[2]||(e[2]=i(" 视频 "))]),_:1,__:[2]})])]),o("div",ge,[(c(!0),u(x,null,P(L.value,s=>{var w,B;return c(),u("div",{key:s.id,class:"card post-card"},[o("div",ke,[o("div",he,[t(g,{size:40,src:((w=s.userInfo)==null?void 0:w.avatar)||""},{default:a(()=>{var p,C;return[i(r(((C=(p=s.userInfo)==null?void 0:p.nickname)==null?void 0:C.charAt(0))||"用户"),1)]}),_:2},1032,["src"]),o("div",ye,[o("div",we,r(((B=s.userInfo)==null?void 0:B.nickname)||"未知用户"),1),o("div",Ce,r(j(s.createTime)),1)])]),t(Y,null,{dropdown:a(()=>[t(X,null,{default:a(()=>[t(T,null,{default:a(()=>e[3]||(e[3]=[i("举报")])),_:1,__:[3]}),t(T,null,{default:a(()=>e[4]||(e[4]=[i("隐藏")])),_:1,__:[4]})]),_:1})]),default:a(()=>[t(v,{class:"more-icon"},{default:a(()=>[t(W)]),_:1})]),_:1})]),o("div",xe,[s.title?(c(),u("h3",Pe,r(s.title),1)):S("",!0),o("p",Le,r(s.content),1),s.images&&s.images.length?(c(),u("div",Ie,[(c(!0),u(x,null,P(s.images,(p,C)=>(c(),D(Z,{key:C,src:p,fit:"cover",class:"post-image","preview-src-list":s.images,"initial-index":C},null,8,["src","preview-src-list","initial-index"]))),128))])):S("",!0),s.tags&&s.tags.length?(c(),u("div",Me,[(c(!0),u(x,null,P(s.tags,p=>(c(),D(ee,{key:p,size:"small",type:"info"},{default:a(()=>[i(" #"+r(p),1)]),_:2},1024))),128))])):S("",!0)]),o("div",be,[o("div",ze,[o("span",Ae,r(s.likeCount)+" 点赞",1),o("span",De,r(s.commentCount)+" 评论",1),o("span",Se,r(s.viewCount)+" 浏览",1)]),o("div",Ve,[t(_,{text:"",type:s.isLiked?"primary":"",onClick:p=>G(s)},{default:a(()=>[t(v,null,{default:a(()=>[t(te)]),_:1}),e[5]||(e[5]=i(" 点赞 "))]),_:2,__:[5]},1032,["type","onClick"]),t(_,{text:"",onClick:p=>J(s)},{default:a(()=>[t(v,null,{default:a(()=>[t(se)]),_:1}),e[6]||(e[6]=i(" 评论 "))]),_:2,__:[6]},1032,["onClick"]),t(_,{text:"",onClick:p=>K(s)},{default:a(()=>[t(v,null,{default:a(()=>[t(oe)]),_:1}),e[7]||(e[7]=i(" 收藏 "))]),_:2,__:[7]},1032,["onClick"]),t(_,{text:""},{default:a(()=>[t(v,null,{default:a(()=>[t(ne)]),_:1}),e[8]||(e[8]=i(" 分享 "))]),_:1,__:[8]})])])])}),128)),o("div",$e,[M.value?(c(),D(_,{key:0,loading:I.value,onClick:U,style:{width:"100%"}},{default:a(()=>e[9]||(e[9]=[i(" 加载更多 ")])),_:1,__:[9]},8,["loading"])):(c(),u("div",Ee,"没有更多内容了"))])])]),_:1}),t(q,{lg:8,md:0,sm:0,xs:0},{default:a(()=>[o("div",Te,[o("div",qe,[e[10]||(e[10]=o("h3",{class:"sidebar-title"},"热门话题",-1)),o("div",Be,[(c(!0),u(x,null,P(N.value,s=>(c(),u("div",{key:s.name,class:"topic-item"},[o("span",He,"#"+r(s.name),1),o("span",Ne,r(s.count)+"条讨论",1)]))),128))])]),o("div",Re,[e[12]||(e[12]=o("h3",{class:"sidebar-title"},"推荐关注",-1)),o("div",Fe,[(c(!0),u(x,null,P(R.value,s=>(c(),u("div",{key:s.id,class:"user-item"},[t(g,{size:32,src:s.avatar},{default:a(()=>{var w;return[i(r((w=s.nickname)==null?void 0:w.charAt(0)),1)]}),_:2},1032,["src"]),o("div",Ue,[o("div",je,r(s.nickname),1),o("div",Ge,r(s.desc),1)]),t(_,{size:"small",type:"primary"},{default:a(()=>e[11]||(e[11]=[i("关注")])),_:1,__:[11]})]))),128))])])])]),_:1})]),_:1})])]),_:1})])}}},Ye=de(Je,[["__scopeId","data-v-f7360334"]]);export{Ye as default};
