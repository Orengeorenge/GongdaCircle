import{r as y,a as Y,m as ge,g as ye,b as c,o as u,c as g,e as n,w as a,E as d,d as t,k as Z,f as m,p as he,F as z,h as D,i as w,t as _,j as K,l as N}from"./index-e807a5c3.js";import{A as ke}from"./AppHeader-c9079225.js";import{r as x,_ as we}from"./_plugin-vue_export-helper-608cf584.js";const F={sendFriendRequest:(f,C="",R="")=>x.post("/friend/apply",{friendId:f,reason:C,remark:R}),getFriendRequests:f=>x.get("/friend/requests",{params:f}),acceptFriendRequest:f=>x.post(`/friend/${f}/approve`),rejectFriendRequest:f=>x.post(`/friend/${f}/reject`),getFriendList:f=>x.get("/friend/list",{params:f}),deleteFriend:f=>x.delete(`/friend/${f}`),searchUsers:f=>x.get("/user/search",{params:{keyword:f}})};const Fe={class:"friends-container"},be={class:"container"},xe={class:"friends-wrapper"},Re={class:"friends-main"},Ce={class:"card search-section"},Ve={class:"search-form"},qe={class:"card add-friend-section"},Ie={class:"card"},Ue={key:0,class:"user-list"},$e={class:"user-info"},ze={class:"user-details"},De={class:"user-main"},Te={class:"nickname"},Me={class:"user-desc"},Se={class:"user-bio"},Be={class:"user-actions"},Ae={key:0,class:"request-list"},je={class:"request-info"},Le={class:"request-details"},Ee={class:"user-main"},Ke={class:"nickname"},Ne={class:"request-time"},Oe={class:"request-reason"},He={class:"request-actions"},Pe={key:0,class:"friends-list"},Ge={class:"friend-info"},Je={class:"friend-details"},Qe={class:"friend-main"},We={class:"nickname"},Xe={class:"friend-desc"},Ye={class:"last-seen"},Ze={class:"friend-actions"},es={class:"friends-sidebar"},ss={class:"card stats-card"},ts={class:"stats-list"},ns={class:"stat-item"},as={class:"stat-value"},os={class:"stat-item"},rs={class:"stat-value"},ls={class:"stat-item"},ds={class:"stat-value"},is={class:"card recommend-card"},cs={class:"recommend-list"},us={class:"recommend-info"},ms={class:"nickname"},_s={class:"reason"},ps={class:"dialog-footer"},fs={__name:"Friends",setup(f){const C=y("search"),R=y(""),V=y(!1),I=y(null),T=y(!1),M=y(),U=y([]),k=y([]),b=y([]),O=y([]),q=Y({targetUserId:""}),ee={targetUserId:[{required:!0,message:"请输入用户ID",trigger:"blur"},{pattern:/^\d+$/,message:"用户ID必须是数字",trigger:"blur"}]},h=Y({reason:"",remark:""}),S=async()=>{M.value&&await M.value.validate(async o=>{var e,i;if(o){T.value=!0;try{const r=await F.sendFriendRequest(parseInt(q.targetUserId));r.data.code===200?(d.success("请求已发送"),q.targetUserId=""):d.error(r.data.message||"发送失败")}catch(r){console.error("发送好友请求错误:",r);const l=((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)||"发送失败，请检查网络连接";d.error(l)}finally{T.value=!1}}})},B=async()=>{try{const o=await F.getFriendList({page:1,size:20,keyword:""});o.data.code===200?b.value=o.data.data.records||[]:d.warning("获取好友列表失败")}catch(o){console.error("获取好友列表错误:",o),d.error("获取好友列表失败，请检查网络连接")}},H=async()=>{try{const o=await F.getFriendRequests({page:1,size:10});o.data.code===200?k.value=o.data.data.records||[]:d.warning("获取好友申请失败")}catch(o){console.error("获取好友申请错误:",o),d.error("获取好友申请失败，请检查网络连接")}},se=async()=>{if(!R.value.trim()){d.warning("请输入搜索关键词");return}try{const o=await F.searchUsers(R.value);o.data.code===200?(U.value=o.data.data||[],C.value="search",d.success(`找到 ${U.value.length} 个用户`)):d.warning(o.data.message||"搜索用户失败")}catch(o){console.error("搜索用户错误:",o),d.error("搜索用户失败，请检查网络连接")}},P=()=>{se()},te=o=>{o==="requests"?H():o==="friends"&&B()},ne=ge(()=>b.value.filter(o=>o.isOnline).length),G=o=>{I.value=o,h.reason="",h.remark=o.nickname,V.value=!0},ae=async()=>{var o,e;try{const i=await F.sendFriendRequest(I.value.id,h.reason,h.remark);i.data.code===200?(V.value=!1,d.success("好友申请已发送"),I.value&&(I.value.friendStatus=1)):d.error(i.data.message||"发送失败")}catch(i){console.error("发送好友请求错误:",i);const r=((e=(o=i.response)==null?void 0:o.data)==null?void 0:e.message)||"发送失败，请检查网络连接";d.error(r)}},oe=o=>{N.confirm(`确定要同意 ${o.user.nickname} 的好友申请吗？`,"确认操作",{confirmButtonText:"同意",cancelButtonText:"取消",type:"info"}).then(async()=>{var e,i;try{const r=await F.acceptFriendRequest(o.id);if(r.data.code===200){const l=k.value.findIndex(v=>v.id===o.id);l>-1&&k.value.splice(l,1),B(),d.success("已同意好友申请")}else d.error(r.data.message||"处理失败")}catch(r){console.error("同意好友申请错误:",r);const l=((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)||"操作失败，请检查网络连接";d.error(l)}})},re=o=>{N.confirm(`确定要拒绝 ${o.user.nickname} 的好友申请吗？`,"确认操作",{confirmButtonText:"拒绝",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,i;try{const r=await F.rejectFriendRequest(o.id);if(r.data.code===200){const l=k.value.findIndex(v=>v.id===o.id);l>-1&&k.value.splice(l,1),d.success("已拒绝好友申请")}else d.error(r.data.message||"处理失败")}catch(r){console.error("拒绝好友申请错误:",r);const l=((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)||"操作失败，请检查网络连接";d.error(l)}})},le=o=>{const[e,i]=o.split("-");switch(e){case"chat":d.info("聊天功能开发中...");break;case"profile":d.info("查看资料功能开发中...");break;case"delete":N.confirm("确定要删除这个好友吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const r=await F.deleteFriend(i);if(r.data.code===200){const l=b.value.findIndex(v=>v.id===parseInt(i));l>-1&&b.value.splice(l,1),d.success("已删除好友")}else d.error(r.data.message||"删除失败")}catch(r){console.error("删除好友错误:",r),d.error("删除失败，请检查网络连接")}});break}},J=o=>{const i=new Date-o,r=Math.floor(i/(1e3*60)),l=Math.floor(i/(1e3*60*60)),v=Math.floor(i/(1e3*60*60*24));return r<1?"刚刚":r<60?`${r}分钟前`:l<24?`${l}小时前`:v<7?`${v}天前`:o.toLocaleDateString()},de=[{id:7,nickname:"班长",avatar:"",reason:"同专业同学"},{id:8,nickname:"学习委员",avatar:"",reason:"共同好友推荐"},{id:9,nickname:"社团伙伴",avatar:"",reason:"参加过相同活动"}];return ye(()=>{B(),H(),O.value=de}),(o,e)=>{const i=c("Search"),r=c("el-icon"),l=c("el-button"),v=c("el-input"),Q=c("User"),A=c("el-form-item"),W=c("el-form"),$=c("el-avatar"),X=c("el-tag"),j=c("el-empty"),L=c("el-tab-pane"),ie=c("ArrowDown"),ce=c("ChatDotRound"),E=c("el-dropdown-item"),ue=c("Delete"),me=c("el-dropdown-menu"),_e=c("el-dropdown"),pe=c("el-tabs"),fe=c("el-main"),ve=c("el-dialog");return u(),g("div",Fe,[n(ke),n(fe,{class:"main-content"},{default:a(()=>[t("div",be,[t("div",xe,[t("div",Re,[t("div",Ce,[e[8]||(e[8]=t("div",{class:"search-header"},[t("h2",null,"添加好友")],-1)),t("div",Ve,[n(v,{modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=s=>R.value=s),placeholder:"搜索用户名、邮箱或手机号",size:"large",clearable:"",onKeyup:Z(P,["enter"])},{prefix:a(()=>[n(r,null,{default:a(()=>[n(i)]),_:1})]),append:a(()=>[n(l,{type:"primary",onClick:P},{default:a(()=>e[7]||(e[7]=[m("搜索")])),_:1,__:[7]})]),_:1},8,["modelValue"])])]),t("div",qe,[e[10]||(e[10]=t("div",{class:"add-friend-header"},[t("h3",null,"直接添加好友"),t("p",null,"如果您知道对方的用户ID，可以直接发送好友请求")],-1)),n(W,{ref_key:"addFriendFormRef",ref:M,model:q,rules:ee,onSubmit:he(S,["prevent"])},{default:a(()=>[n(A,{prop:"targetUserId"},{default:a(()=>[n(v,{modelValue:q.targetUserId,"onUpdate:modelValue":e[1]||(e[1]=s=>q.targetUserId=s),placeholder:"请输入用户ID",size:"large",clearable:"",onKeyup:Z(S,["enter"])},{prefix:a(()=>[n(r,null,{default:a(()=>[n(Q)]),_:1})]),append:a(()=>[n(l,{type:"primary",loading:T.value,onClick:S},{default:a(()=>e[9]||(e[9]=[m(" 发送请求 ")])),_:1,__:[9]},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),t("div",Ie,[n(pe,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=s=>C.value=s),onTabChange:te},{default:a(()=>[n(L,{label:"搜索结果",name:"search"},{default:a(()=>[U.value.length?(u(),g("div",Ue,[(u(!0),g(z,null,D(U.value,s=>(u(),g("div",{key:s.id,class:"user-item"},[t("div",$e,[n($,{size:50,src:s.avatar},{default:a(()=>{var p;return[m(_((p=s.nickname)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"]),t("div",ze,[t("div",De,[t("span",Te,_(s.nickname),1),s.isOnline?(u(),w(X,{key:0,type:"success",size:"small"},{default:a(()=>e[11]||(e[11]=[m("在线")])),_:1,__:[11]})):K("",!0)]),t("div",Me,_(s.school)+" · "+_(s.major),1),t("div",Se,_(s.biography),1)])]),t("div",Be,[s.friendStatus===0?(u(),w(l,{key:0,type:"primary",size:"small",onClick:p=>G(s)},{default:a(()=>e[12]||(e[12]=[m(" 添加好友 ")])),_:2,__:[12]},1032,["onClick"])):s.friendStatus===1?(u(),w(l,{key:1,type:"info",size:"small",disabled:""},{default:a(()=>e[13]||(e[13]=[m(" 已发送请求 ")])),_:1,__:[13]})):s.friendStatus===2?(u(),w(l,{key:2,type:"success",size:"small",disabled:""},{default:a(()=>e[14]||(e[14]=[m(" 已是好友 ")])),_:1,__:[14]})):K("",!0)])]))),128))])):(u(),w(j,{key:1,description:"暂无搜索结果"}))]),_:1}),n(L,{label:"好友申请",name:"requests"},{default:a(()=>[k.value.length?(u(),g("div",Ae,[(u(!0),g(z,null,D(k.value,s=>(u(),g("div",{key:s.id,class:"request-item"},[t("div",je,[n($,{size:50,src:s.user.avatar},{default:a(()=>{var p;return[m(_((p=s.user.nickname)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"]),t("div",Le,[t("div",Ee,[t("span",Ke,_(s.user.nickname),1),t("span",Ne,_(J(s.createTime)),1)]),t("div",Oe,"申请理由："+_(s.reason||"希望成为好友"),1)])]),t("div",He,[n(l,{type:"primary",size:"small",onClick:p=>oe(s)},{default:a(()=>e[15]||(e[15]=[m(" 同意 ")])),_:2,__:[15]},1032,["onClick"]),n(l,{size:"small",onClick:p=>re(s)},{default:a(()=>e[16]||(e[16]=[m(" 拒绝 ")])),_:2,__:[16]},1032,["onClick"])])]))),128))])):(u(),w(j,{key:1,description:"暂无好友申请"}))]),_:1}),n(L,{label:"我的好友",name:"friends"},{default:a(()=>[b.value.length?(u(),g("div",Pe,[(u(!0),g(z,null,D(b.value,s=>(u(),g("div",{key:s.id,class:"friend-item"},[t("div",Ge,[n($,{size:50,src:s.avatar},{default:a(()=>{var p;return[m(_((p=s.nickname)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"]),t("div",Je,[t("div",Qe,[t("span",We,_(s.nickname),1),s.isOnline?(u(),w(X,{key:0,type:"success",size:"small"},{default:a(()=>e[17]||(e[17]=[m("在线")])),_:1,__:[17]})):K("",!0)]),t("div",Xe,_(s.school)+" · "+_(s.major),1),t("div",Ye,"最后在线："+_(J(s.lastLoginTime)),1)])]),t("div",Ze,[n(_e,{onCommand:le},{dropdown:a(()=>[n(me,null,{default:a(()=>[n(E,{command:`chat-${s.id}`},{default:a(()=>[n(r,null,{default:a(()=>[n(ce)]),_:1}),e[19]||(e[19]=m(" 发送消息 "))]),_:2,__:[19]},1032,["command"]),n(E,{command:`profile-${s.id}`},{default:a(()=>[n(r,null,{default:a(()=>[n(Q)]),_:1}),e[20]||(e[20]=m(" 查看资料 "))]),_:2,__:[20]},1032,["command"]),n(E,{command:`delete-${s.id}`,divided:""},{default:a(()=>[n(r,null,{default:a(()=>[n(ue)]),_:1}),e[21]||(e[21]=m(" 删除好友 "))]),_:2,__:[21]},1032,["command"])]),_:2},1024)]),default:a(()=>[n(l,{size:"small"},{default:a(()=>[e[18]||(e[18]=m(" 更多操作 ")),n(r,{class:"el-icon--right"},{default:a(()=>[n(ie)]),_:1})]),_:1,__:[18]})]),_:2},1024)])]))),128))])):(u(),w(j,{key:1,description:"暂无好友"}))]),_:1})]),_:1},8,["modelValue"])])]),t("div",es,[t("div",ss,[e[25]||(e[25]=t("h3",null,"好友统计",-1)),t("div",ts,[t("div",ns,[e[22]||(e[22]=t("span",{class:"stat-label"},"好友总数",-1)),t("span",as,_(b.value.length),1)]),t("div",os,[e[23]||(e[23]=t("span",{class:"stat-label"},"待处理申请",-1)),t("span",rs,_(k.value.length),1)]),t("div",ls,[e[24]||(e[24]=t("span",{class:"stat-label"},"在线好友",-1)),t("span",ds,_(ne.value),1)])])]),t("div",is,[e[27]||(e[27]=t("h3",null,"可能认识的人",-1)),t("div",cs,[(u(!0),g(z,null,D(O.value,s=>(u(),g("div",{key:s.id,class:"recommend-item"},[n($,{size:40,src:s.avatar},{default:a(()=>{var p;return[m(_((p=s.nickname)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"]),t("div",us,[t("div",ms,_(s.nickname),1),t("div",_s,_(s.reason),1)]),n(l,{size:"small",type:"primary",onClick:p=>G(s)},{default:a(()=>e[26]||(e[26]=[m(" 添加 ")])),_:2,__:[26]},1032,["onClick"])]))),128))])])])])])]),_:1}),n(ve,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=s=>V.value=s),title:"发送好友申请",width:"400px"},{footer:a(()=>[t("span",ps,[n(l,{onClick:e[5]||(e[5]=s=>V.value=!1)},{default:a(()=>e[28]||(e[28]=[m("取消")])),_:1,__:[28]}),n(l,{type:"primary",onClick:ae},{default:a(()=>e[29]||(e[29]=[m("发送申请")])),_:1,__:[29]})])]),default:a(()=>[n(W,{model:h,"label-width":"80px"},{default:a(()=>[n(A,{label:"申请理由"},{default:a(()=>[n(v,{modelValue:h.reason,"onUpdate:modelValue":e[3]||(e[3]=s=>h.reason=s),type:"textarea",rows:3,placeholder:"请输入申请理由（可选）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(A,{label:"备注名称"},{default:a(()=>[n(v,{modelValue:h.remark,"onUpdate:modelValue":e[4]||(e[4]=s=>h.remark=s),placeholder:"请输入备注名称（可选）",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},hs=we(fs,[["__scopeId","data-v-20ff0e59"]]);export{hs as default};
